name: build-and-test
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
        - name: Setup Build Environment âŒ›
          run: sudo apt-get install -y g++ libmpdec-dev libfmt-dev cmake libboost-all-dev doxygen doxygen-doc doxygen-latex
          
        - name: Checkout googletest â³
          uses: actions/checkout@v2
          with:
            repository: google/googletest
            ref: release-1.11.0
            path: googletest
            
        - name: Build googletest ğŸ”§
          run: |
            cd googletest && mkdir build && cd build && cmake ../ && make && sudo make install
            
        - name: Checkout Source Code â¬
          uses: actions/checkout@v2
          
        - name: Build libmpdec ğŸ› 
          run: |
            mkdir -p build
            cd build
            cmake -DBUILD_TESTS=ON ../
            make
            make doc
            
        - name: Run Tests ğŸ§ª
          run: cd build && ctest
          
        - name: Publish Unit Test Results ğŸ”ƒ
          uses: EnricoMi/publish-unit-test-result-action@v1
          if: always()
          with:
            files: build/test/gtestresult/*.xml
        
        - name: Deploy ğŸš€
          uses: JamesIves/github-pages-deploy-action@4.1.4
          with:
            branch: gh-pages
            folder: build/doc/html
